<div class="ui tiny rounded image">
  {{display/employee-picture url=user.employee.picture employeeId=user.employee.id}}
</div>
<div class="content">
  <div class="header">
    {{user.fullName}}
    {{#if user.inactive}}
      <label class="ui red label">Inactive</label>
    {{/if}}
  </div>
  <div class="right floated">
    {{#link-to "account.anatomy.company-users.edit" user.id}}
      {{#ui-popup tagName="span" position="left center" content="Edit user"}}
        <i class="edit icon"></i>
      {{/ui-popup}}
    {{/link-to}}
    {{#if user.inactive}}
      {{#ui-popup tagName="span" position="left center" content="Reactivate user"}}
        <a href="#" {{action "toggleInactiveState" false}}>
          <i class="{{if working "loading spinner" "undo"}} icon"></i>
        </a>
      {{/ui-popup}}
    {{else}}
      {{#ui-popup tagName="span" position="left center" content="Deactivate user"}}
        <a href="#" class="text-danger" {{action "openTransferModal"}}>
          <i class="{{if working "loading spinner" "times"}} icon"></i>
        </a>
      {{/ui-popup}}
    {{/if}}
  </div>
  <div class="meta">
    <span>{{user.email}}</span>
    <span class="ui small text right floated">Created {{time-ago user.created}} on {{time user.created}}</span>
  </div>
  <div class="extra">
    {{#if user.activatedOn}}
      <i class="check icon"></i>Activated {{time-ago user.activatedOn}}
    {{else}}
      <span class="text-green"><i class="mail outline icon"></i>Activation email sent {{time-ago user.created}}</span>
    {{/if}}
  </div>
</div>

{{#ui-modal name="modal__transfer-projects" id=modalId class="small form"}}
  <div class="header">
    Transfer {{user.fullName}}'s projects
  </div>
  <div class="content">
    <div class="ui relaxed divided list">
      {{#each projects as |project|}}
        <div class="item">
          <div class="content">
            <div class="header">
              {{project.title}}
              <label class="ui tiny left floated red label">{{project.priority}}</label>
            </div>
            {{#if project.description}}
              <div class="description">
                {{project.description}}
              </div>
            {{/if}}
          </div>
        </div>
      {{else}}
        {{user.firstName}} has no outstanding projects.
      {{/each}}
    </div>

    {{#if projects.length}}
      <label for={{dropdownId}}>Transfer to</label>
      {{#ui-dropdown class="fluid selection" id=dropdownId selected=newOwner onChange=(action (mut newOwner)) as |execute mapper|}}
        <div class="default text">New Owner</div>
        <i class="dropdown icon"></i>
        <div class="menu">
          {{#each users as |user|}}
            <div data-value={{map-value mapper user.employee}} class="item">
              {{user.fullName}}
            </div>
          {{/each}}
        </div>
      {{/ui-dropdown}}
    {{/if}}
  </div>
  <div class="actions">
    <button class="ui inverted red button" {{action 'cancel'}}>Cancel</button>
    <button class="ui primary button" {{action (pipe (action "transferProjects")(action "toggleInactiveState" true))}} disabled={{disableDeactivate}}>Confirm Deactivation</button>
  </div>
{{/ui-modal}}
