{{intro-js steps=intros start-if=data}}
<h1 class="ui center aligned inverted header">
  Census Upload
  {{#liquid-if data}}
    <small><a href="#" class="census__start-over" {{action "reset"}}><i class="horizontally flipped repeat icon"></i>Start Over</a></small>
  {{/liquid-if}}
</h1>

<div class="ui divider"></div>

{{#liquid-if data}}
  <form {{action "importRecords" on="submit"}}>
    <div class="ui raised very padded fluid container">
      <div class="responsive-table census__table">
        <table class="ui striped celled table">
          <thead>
            <tr class="guess-fields-row">
              <th>
                <div class="ui red ribbon label">
                  {{#ui-popup content='We have attempted to guess the columns that you uploaded. This row represents our guesses.'}}
                    Guessed Fields
                  {{/ui-popup}}
                </div>
              </th>
              {{#each data.[0] as |guesses i|}}
                <th>
                  <div class="field">
                    {{#ui-dropdown
                      class="scrolling census__field-selection"
                      direction="downward"
                      name="guess-column"
                      selected=guesses
                      onChange=(action 'mutateGuess' i)}}
                      <div class="default text">Select field for column</div>
                      <i class="dropdown icon"></i>
                      <div class="menu">
                        {{#each availableFields as |availableField|}}
                          <div class="item" data-id="{{availableField}}">
                            {{availableField}}
                          </div>
                        {{/each}}
                      </div>
                    {{/ui-dropdown}}
                  </div>
                </th>
              {{/each}}
            </tr>
            <tr class="client-fields-row">
              <th>
                <div class="ui blue ribbon label">
                  {{#ui-popup content='We show the column labels you originally uploaded here for reference.'}}
                    Your Columns
                  {{/ui-popup}}
                </div>
              </th>
              {{#each data.[1] as |clientDataNames|}}
                <th>{{clientDataNames}}</th>
              {{/each}}
            </tr>
          </thead>
          <tbody class="monospaced data-rows">
            {{#each rows as |row rowIndex|}}
              <tr>
                <td>
                  {{add-one rowIndex}}
                </td>
                {{#each row as |column|}}
                  <td>
                    {{column}}
                  </td>
                {{/each}}
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <div class="ui divider"></div>

      {{#form/action-button type="submit" class="ui fluid positive big button import-button" loading=working}}
        <i class="check icon"></i> Import {{rows.length}} records
      {{/form/action-button}}
    </div>
  </form>
{{else}}
  {{elements/file-uploader
    url="/api/v1/employee/census/upload"
    autoUpload=true
    allowedExtensions=supportedExtensions
    dragText='Drag Your Census File Here'
    onWinning=(action "successHandler")
    onError=(action "fileUploadError")
    onNotify=(action "onNotify")}}
{{/liquid-if}}
